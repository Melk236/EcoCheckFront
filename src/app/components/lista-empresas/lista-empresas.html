<div class="px-4 md:px-10 lg:px-40 pt-20 flex flex-1 justify-center py-5 bg-[#f6f8f7] dark:bg-gray-800 min-h-screen">
    <div class="flex flex-col max-w-[1200px] flex-1 ">

        <!-- Hero / Search Section -->
        <div class="mb-8">
            <div
                class="flex min-h-80 flex-col gap-6 bg-cover bg-center bg-no-repeat rounded-2xl items-center justify-center p-8 relative overflow-hidden cabecera-fondo">
                <div class="flex flex-col gap-3 text-center z-10 max-w-2xl">
                    <h1 class="text-white text-4xl md:text-5xl font-black leading-tight tracking-[-0.033em]">
                        Directorio de Empresas Sostenibles
                    </h1>
                    <p class="text-gray-200 text-base md:text-lg font-normal leading-normal">
                        Encuentra organizaciones comprometidas con el impacto ambiental y social positivo.
                    </p>
                </div>
                <label class="flex flex-col w-full max-w-[600px] z-10">
                    <div
                        class="flex w-full flex-1 items-stretch rounded-xl h-14 bg-white dark:bg-gray-700 shadow-lg overflow-hidden focus-within:ring-2 focus-within:ring-[#13ec6d]/50 dark:focus-within:ring-green-400 transition-all">
                        <div class="text-[#618972] flex items-center justify-center pl-4 pr-2">
                            <span class="material-symbols-outlined">search</span>
                        </div>
                        <input [(ngModel)]="busqueda" (input)="filtrar()"
                            class="flex w-full min-w-0 flex-1 resize-none bg-transparenttext-[#111814] dark:text-white placeholder:text-[#618972] dark:placeholder:text-gray-400 focus:outline-0 text-base font-normal leading-normal px-2"
                            placeholder="Buscar por nombre, sector o etiqueta (ej. Textil, Carbono Neutral)..."
                            value="" />
                        <div class="flex items-center justify-center pr-2">
                            <button
                                class="flex min-w-[84px] cursor-pointer items-center justify-center rounded-lg h-10 px-5 bg-green-600 dark:bg-green-600 text-white text-sm font-bold hover:bg-green-700 dark:hover:bg-green-700 transition-colors">
                                Buscar
                            </button>
                        </div>
                    </div>
                </label>
            </div>
        </div>

        <!-- Filters & Stats Bar -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
            <!-- Chips / Filters -->
            <div class="flex gap-2 flex-wrap items-center relative">
                <span class="text-[#111814] dark:text-gray-300 font-bold text-sm mr-2">Filtrar por:</span>
                <!-- Reemplazadas todas las clases dark: con paleta gray estándar -->
                
                <div class="relative">
                    <button
                        class="group flex h-9 items-center justify-center gap-x-2 rounded-lg bg-white dark:bg-gray-700 border border-[#dbe6e0] dark:border-gray-600 hover:border-[#13ec6d]/50 transition-all pl-3 pr-2"
                        (click)="toggleDropdownPuntuacion(); $event.stopPropagation()">
                        <p class="text-[#111814] dark:text-white text-sm font-medium">Puntuación</p>
                        <span
                            class="material-symbols-outlined text-[#618972] group-hover:text-[#13ec6d]" [class.rotate-180]="mostrarDropdownPuntuacion">keyboard_arrow_down</span>
                    </button>
                    @if(mostrarDropdownPuntuacion){
                    <div class="absolute top-full left-0 mt-2 w-48 bg-white dark:bg-gray-700 border border-[#dbe6e0] dark:border-gray-600 rounded-lg shadow-lg z-50" (click)="$event.stopPropagation()">
                        <ul class="py-2">
                            <li class="cursor-pointer" ><a (click)="filtrarPorPuntuacion($event,1)" class="block px-4 py-2 text-sm text-[#111814] dark:text-white hover:bg-gray-100 dark:hover:bg-gray-600"
                                [ngClass]="{'bg-gray-100 dark:bg-gray-600':filtroSeleccionadoPuntuacion==0}">Todas las puntuaciones</a></li>
                            <li class="cursor-pointer"><a (click)="filtrarPorPuntuacion($event,1)"  class="block px-4 py-2 text-sm text-[#111814] dark:text-white hover:bg-gray-100 dark:hover:bg-gray-600" [ngClass]="{'bg-gray-100 dark:bg-gray-600':filtroSeleccionadoPuntuacion==1}">80-100 (Alta)</a></li>
                            <li class="cursor-pointer"><a (click)="filtrarPorPuntuacion($event,2)"class="block px-4 py-2 text-sm text-[#111814] dark:text-white hover:bg-gray-100 dark:hover:bg-gray-600" [ngClass]="{'bg-gray-100 dark:bg-gray-600':filtroSeleccionadoPuntuacion==2}">50-79 (Media)</a></li>
                            <li class="cursor-pointer"><a (click)="filtrarPorPuntuacion($event,3)" class="block px-4 py-2 text-sm text-[#111814] dark:text-white hover:bg-gray-100 dark:hover:bg-gray-600" [ngClass]="{'bg-gray-100 dark:bg-gray-600':filtroSeleccionadoPuntuacion==3}">0-49 (Baja)</a></li>
                        </ul>
                    </div>
                    }
                </div>
                <div class="relative">
                    <button
                        class="group flex h-9 items-center justify-center gap-x-2 rounded-lg bg-white dark:bg-gray-700 border border-[#dbe6e0] dark:border-gray-600 hover:border-[#13ec6d]/50 transition-all pl-3 pr-2"
                        (click)="toggleDropdownCertificaciones(); $event.stopPropagation()">
                        <p class="text-[#111814] dark:text-gray-200 text-sm font-medium">Certificaciones</p>
                        <span
                            class="material-symbols-outlined text-[#618972] group-hover:text-[#13ec6d]" [class.rotate-180]="mostrarDropdownCertificaciones">keyboard_arrow_down</span>
                    </button>
                    @if(mostrarDropdownCertificaciones){
                    <div class="absolute top-full left-0 mt-2 w-48 max-h-40 overflow-y-auto bg-white dark:bg-gray-700 border border-[#dbe6e0] dark:border-gray-600 rounded-lg shadow-lg z-50" (click)="$event.stopPropagation()">
                        <ul class="py-2" >
                            <li class="cursor-pointer"><a (click)="filtrarPorCertificacion($event,0)" [ngClass]="{'bg-gray-100 dark:bg-gray-600':filtroSeleccionadoCertificacion==0}"class="block px-4 py-2 text-sm text-[#111814] dark:text-white hover:bg-gray-100 dark:hover:bg-gray-600">Todas las certificaciones</a></li>
                            @for(certificacion of certificaciones;track certificacion.id){
                                 <li class="cursor-pointer"><a (click)="filtrarPorCertificacion($event,certificacion.id)" [ngClass]="{'bg-gray-100 dark:bg-gray-600':filtroSeleccionadoCertificacion==certificacion.id}" class="block px-4 py-2 text-sm text-[#111814] dark:text-white hover:bg-gray-100 dark:hover:bg-gray-600">{{certificacion.nombre}}</a></li>
                            }
                           
                            
                        </ul>
                    </div>
                    }
                </div>
                <button
                    class="flex h-9 items-center justify-center gap-x-2 text-[#13ec6d] hover:underline pl-2 text-sm font-medium"
                    (click)="limpiarFiltros()"
                    [class.hidden]="!tieneFiltrosActivos()">
                    Limpiar filtros
                </button>
            </div>
            <!-- Active Filters -->
            @if(tieneFiltrosActivos()){
            <div class="flex gap-2 flex-wrap items-center mt-2">
                <span class="text-[#111814] dark:text-gray-300 text-xs font-medium">Filtros activos:</span>
                @if(filtroPuntuacion){
                <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 text-xs font-medium">
                    {{filtroPuntuacion}}
                    <button (click)="limpiarFiltros()" class="hover:text-green-900 dark:hover:text-green-100">
                        <span class="material-symbols-outlined text-xs">close</span>
                    </button>
                </span>
                }
                @if(filtroCertificacion !== 'Todas las certificaciones'){
                <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-xs font-medium">
                    {{filtroCertificacion}}
                    <button (click)="limpiarFiltros()" class="hover:text-blue-900 dark:hover:text-blue-100">
                        <span class="material-symbols-outlined text-xs">close</span>
                    </button>
                </span>
                }
                @if(busqueda.trim()){
                <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 text-xs font-medium">
                    "{{busqueda}}"
                    <button (click)="limpiarFiltros()" class="hover:text-purple-900 dark:hover:text-purple-100">
                        <span class="material-symbols-outlined text-xs">close</span>
                    </button>
                </span>
                }
            </div>
            }
            <!-- Result Count -->
            <p class="text-[#618972] dark:text-gray-400 text-sm font-normal">Mostrando 12 de 145 empresas</p>
        </div>

        <!-- Company Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 pb-12">
            <!-- Card 1 -->
            <!-- Aplicada paleta gray en todas las cards -->
            @for(empresa of listaEmpresasPaginacion;track empresa.id){

            <div
                class="cards group flex flex-col bg-white dark:bg-gray-700 rounded-xl overflow-hidden border border-[#f0f4f2] dark:border-gray-600 hover:shadow-lg dark:hover:shadow-[#13ec6d]/10 transition-all duration-300">
                <div class="relative h-40 bg-cover bg-center fondo-imagen">
                    <div
                        class="absolute top-3 right-3 bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm px-2 py-1 rounded-md flex items-center gap-1 shadow-sm">

                        <span class="material-symbols-outlined text-[18px]" [ngClass]="clasesEmpresa.get(empresa.id)">
                            groups
                        </span>
                        <span
                            class="text-[#111814] dark:text-white text-xs font-bold">{{empresa.puntuacionSocial}}/100</span>


                    </div>
                </div>
                <div class="p-5 flex flex-col gap-3 flex-1">
                    <div class="flex items-start justify-between">
                        <div>
                            <p
                                class="text-[#618972] dark:text-gray-400 text-xs font-bold uppercase tracking-wider mb-1">
                                {{empresa.empresaMatriz ?? empresa.nombre}}</p>
                            <h3
                                class="text-[#111814] dark:text-white text-lg font-bold leading-tight group-hover:text-[#13ec6d] transition-colors">
                                {{empresa.nombre}}</h3>
                        </div>
                        <div class="size-10 rounded-full bg-gray-100 shrink-0 border border-gray-200 overflow-hidden">
                            <img alt="Company Logo" class="w-full h-full object-cover"
                                src="https://lh3.googleusercontent.com/aida-public/AB6AXuBCP2ClvLPEWzaBq4r8UFkG-qtv2k3K0Q-Xhku6mEHSu51jFIGkmuof0qYCZfRyi8rJPGNWEoteLqyxqgDb0snloRGHRWnR5Imy1FUYN_ODqdOEUYVcJEkLgaTTjhdVBU3W-pl5Dlcka1dhtL2TqAEz1EJB8mZVN9nsKEXFptAUmcPKIoO9p_ngNmXclJlBQNvXzEFMitl-DPiRC5AX4ulnfDw5J8mVTYJfHj6UEEPOHl5oJGLn1w3LQn9EqttPwOBO9T0gwCbF7ICu" />
                        </div>
                    </div>
                    <p class="text-[#111814]/70 dark:text-gray-400 text-sm ">{{empresa.descripcion}}</p>
                    <div class="flex flex-wrap gap-2 mt-auto pt-2">
                        <!--Certificaciones de la empresa-->
                        @for(certificacion of empresa.certificacion;track $index){

                        @if($index<3){ <span
                            class="bg-[#f0f4f2] dark:bg-gray-600 text-[#111814] dark:text-gray-200 text-xs px-2 py-1 rounded font-medium">
                            {{certificacion}}</span>
                            }

                            }


                    </div>
                    <button type="button" (click)="irEmpresa(empresa.id)"
                        class="mt-2 w-full py-2 rounded-lg border border-gray-200 dark:border-gray-600 text-[#111814] dark:text-white text-sm font-bold hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                        Ver Perfil
                    </button>
                </div>
            </div>
            }
        </div>

        <app-paginacion [lista]="listaEmpresasFiltradas" (pagin)="paginar($event)"></app-paginacion>

    </div>