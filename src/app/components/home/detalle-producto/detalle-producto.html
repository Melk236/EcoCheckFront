<div class="flex-1 p-6 lg:p-10 bg-gray-100 dark:bg-gray-800 min-h-screen">
  <div class="flex flex-col w-full max-w-7xl mx-auto pt-15">

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Left Column: Product Info & EcoScore -->
      <div class="lg:col-span-2 flex flex-col gap-8">
        <!-- Product Card -->
        <div class="p-6 bg-white dark:bg-gray-700 rounded-xl shadow-sm">
          <div class="flex flex-col items-stretch justify-start lg:flex-row lg:items-start gap-6">
            <div class="w-48 h-48 shrink-0 rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-600">
              <img [src]="producto.imagenUrl" alt="{{ producto.nombre }}" class="w-full h-full object-contain">
            </div>
            <div class="flex w-full grow flex-col items-stretch justify-center gap-2">
              <div class="flex justify-between items-center gap-2">
                <p class="text-gray-700 dark:text-white text-2xl font-bold leading-tight tracking-tight">
                  {{producto.nombre}}</p>
                <div class="flex gap-2">
                  <svg class="h-6 fill-gray-700 dark:fill-gray-300" viewBox="0 0 50 50"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M8 2L8 6L4 6L4 48L46 48L46 14L30 14L30 6L26 6L26 2 Z M 10 4L24 4L24 8L28 8L28 46L19 46L19 39L15 39L15 46L6 46L6 8L10 8 Z M 10 10L10 12L12 12L12 10 Z M 14 10L14 12L16 12L16 10 Z M 18 10L18 12L20 12L20 10 Z M 22 10L22 12L24 12L24 10 Z M 10 15L10 19L12 19L12 15 Z M 14 15L14 19L16 19L16 15 Z M 18 15L18 19L20 19L20 15 Z M 22 15L22 19L24 19L24 15 Z M 30 16L44 16L44 46L30 46 Z M 32 18L32 20L34 20L34 18 Z M 36 18L36 20L38 20L38 18 Z M 40 18L40 20L42 20L42 18 Z M 10 21L10 25L12 25L12 21 Z M 14 21L14 25L16 25L16 21 Z M 18 21L18 25L20 25L20 21 Z M 22 21L22 25L24 25L24 21 Z M 32 22L32 24L34 24L34 22 Z M 36 22L36 24L38 24L38 22 Z M 40 22L40 24L42 24L42 22 Z M 32 26L32 28L34 28L34 26 Z M 36 26L36 28L38 28L38 26 Z M 40 26L40 28L42 28L42 26 Z M 10 27L10 31L12 31L12 27 Z M 14 27L14 31L16 31L16 27 Z M 18 27L18 31L20 31L20 27 Z M 22 27L22 31L24 31L24 27 Z M 32 30L32 32L34 32L34 30 Z M 36 30L36 32L38 32L38 30 Z M 40 30L40 32L42 32L42 30 Z M 10 33L10 37L12 37L12 33 Z M 14 33L14 37L16 37L16 33 Z M 18 33L18 37L20 37L20 33 Z M 22 33L22 37L24 37L24 33 Z M 32 34L32 36L34 36L34 34 Z M 36 34L36 36L38 36L38 34 Z M 40 34L40 36L42 36L42 34 Z M 32 38L32 40L34 40L34 38 Z M 36 38L36 40L38 40L38 38 Z M 40 38L40 40L42 40L42 38 Z M 10 39L10 44L12 44L12 39 Z M 22 39L22 44L24 44L24 39 Z M 32 42L32 44L34 44L34 42 Z M 36 42L36 44L38 44L38 42 Z M 40 42L40 44L42 44L42 42Z">
                    </path>
                  </svg>
                  <p class="text-gray-500 dark:text-gray-400 text-sm font-medium leading-normal">{{marca.nombre}}</p>
                </div>
              </div>
              <p class="text-gray-500 dark:text-gray-400 mt-2 text-base font-normal leading-normal">
                <span class="text-gray-700 dark:text-white text-base font-normal leading-normal">Ingredientes:</span>
                {{producto.ingredientes}}
              </p>
            </div>
          </div>
        </div>

        <!-- Score Breakdown Section -->
        <div>
          <h2 class="text-gray-700 dark:text-white text-xl font-bold leading-tight tracking-tight pb-4">Desglose de
            Puntuación</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Environmental Card -->
            <div class="flex flex-col gap-4 p-4 bg-white dark:bg-gray-700 rounded-xl shadow-sm">
              <div class="flex items-center gap-3">
                <div class="p-2 rounded-full" [ngClass]="{'bg-green-100 dark:bg-green-900/50':puntuacion.valorAmbiental>=80,
                   'bg-yellow-100 dark:bg-yellow-900/50':puntuacion.valorAmbiental >= 50 && puntuacion.valorAmbiental < 80,
                   'bg-red-100 dark:bg-red-900/50':puntuacion.valorAmbiental<50
                }">
                  <span class="material-symbols-outlined" [ngClass]="getColorClase(puntuacion.valorAmbiental)">eco</span>
                </div>
                <p class="text-gray-700 dark:text-white text-base font-semibold leading-normal">Ambiental</p>
                <div class="relative group cursor-pointer" (mouseover)="mostrarInfoAmbiental()"
                  (mouseout)="cerrarInfoAmbiental()">
                  <span
                    class="material-symbols-outlined text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-lg">info</span>
                  @if(modalInfoAmbiental){
                  <div
                    class="absolute -left-25 top-full sm:left-0 sm:translate-x-0 md:left-0 md:top-auto md:bottom-7 bg-gray-900 dark:bg-gray-950 text-white text-sm rounded-lg p-3 w-70 shadow-lg z-10 pointer-events-none">
                    Evalúa el impacto del envase del producto, teniendo en cuenta los materiales, su reciclabilidad, el
                    impacto de carbono y el origen. Cuanto menor es el impacto ambiental, mayor es la puntuación
                    (0–100).
                  </div>
                  }
                </div>
              </div>
              <div class="rounded-full bg-gray-200 dark:bg-gray-600 h-2">
              <div class="h-2 rounded-full" [style]="'width:'+puntuacion.valorAmbiental+'%;'" [ngClass]="getBgColorClase(puntuacion.valorAmbiental)"></div>
              </div>
              <p class="text-gray-500 dark:text-gray-400 text-right text-sm font-medium leading-normal">
                {{formatNumber(puntuacion.valorAmbiental)}}/100</p>
            </div>

            <!-- Social Card -->
            <div class="flex flex-col gap-4 p-4 bg-white dark:bg-gray-700 rounded-xl shadow-sm">
              <div class="flex items-center gap-3">
                <div class="p-2 rounded-full" [ngClass]="{'bg-green-100 dark:bg-green-900/50':puntuacion.valorSocial>=80,
                   'bg-yellow-100 dark:bg-yellow-900/50':puntuacion.valorSocial >= 50 && puntuacion.valorSocial < 80,
                   'bg-red-100 dark:bg-red-900/50':puntuacion.valorSocial<50
                }">
                  <span class="material-symbols-outlined" [ngClass]="getColorClase(puntuacion.valorSocial)">groups</span>
                </div>
                <p class="text-gray-700 dark:text-white text-base font-semibold leading-normal">Social</p>
                <div class="relative group cursor-pointer" (mouseover)="mostrarInfoSocial()"
                  (mouseout)="cerrarInfoSocial()">
                  <span
                    class="material-symbols-outlined text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-lg">info</span>
                  @if(modalInfoSocial){
                  <div
                    class="absolute -left-25 top-full sm:left-0 sm:translate-x-0 md:left-0 md:top-auto md:bottom-7 bg-gray-900 dark:bg-gray-950 text-white text-sm rounded-lg p-3 w-70 shadow-lg z-10 pointer-events-none">
                    Mide el compromiso social de la empresa fabricante, basándose en sus prácticas laborales, ética
                    empresarial y responsabilidad social. La puntuación se obtiene de una base de datos de marcas
                    (0–100).
                  </div>
                  }
                </div>
              </div>
              <div class="rounded-full bg-gray-200 dark:bg-gray-600 h-2">
              <div class="h-2 rounded-full" [style]="'width:'+puntuacion.valorSocial+'%;'" [ngClass]="getBgColorClase(puntuacion.valorSocial)"></div>
              </div>
              <p class="text-gray-500 dark:text-gray-400 text-right text-sm font-medium leading-normal">
                {{formatNumber(puntuacion.valorSocial)}}/100</p>
            </div>
          </div>
        </div>

        <!-- Sección de Alternativas Sostenibles - DENTRO de la columna izquierda -->
        <div id="alternativas">
          @if(mostrarAlternativas){
          <div
            class="bg-white dark:bg-gray-700 rounded-xl shadow-lg border border-gray-200 dark:border-gray-600 flex flex-col ">
            <!-- Header -->
            <div class="p-5 border-b border-gray-100 dark:border-gray-600 flex items-center gap-2">
              <span class="material-symbols-outlined text-green-600 dark:text-green-400 text-2xl">eco</span>
              <h2 class="text-xl font-bold text-gray-800 dark:text-white">Alternativas Sostenibles</h2>
            </div>

            <!-- Content -->
            <div class="p-5 flex-1 overflow-y-auto">
              <p class="text-gray-500 dark:text-gray-400 mb-6 text-sm">Estos productos ofrecen una mayor sostenibilidad
                ambiental basándose en su proceso de producción y materiales.</p>

              <div class="flex flex-wrap justify-center gap-4">
                @for(alternativa of productos; track $index){
                  <div
                    class="cards flex flex-col gap-3 p-4 bg-white dark:bg-gray-800 rounded-xl border border-[#dbe6e0] dark:border-gray-600 hover:border-[#39E079]/50 dark:hover:border-[#39E079]/50 w-72 cursor-pointer " (click)="abrirDetalle(alternativa.id)">
                  <div
                    class="aspect-square w-full rounded-lg bg-center bg-cover bg-no-repeat bg-gray-200 dark:bg-gray-600"
                    [style]="'background-image: url(' + alternativa.imagenUrl + ')'"></div>
                  <div class="flex flex-col gap-1">
                    <p class="text-xs font-bold text-green-600 dark:text-green-400 uppercase tracking-wider">
                      {{alternativa.paisOrigen}}</p>
                    <h3 class="font-bold text-gray-800 dark:text-white text-base">{{alternativa.nombre}}</h3>
                  </div>
                  <div
                    class="flex items-center justify-between mt-auto pt-3 border-t border-green-600/10 dark:border-gray-600">
                    <div class="flex flex-col">
                      <span class="text-[10px] text-gray-500 dark:text-gray-400 font-bold uppercase">EcoScore</span>
                      <span
                        class="text-xl font-extrabold" [ngClass]="getColorClase(alternativa.ecoScore)">{{formatNumber(alternativa.ecoScore)}}/100</span>
                    </div>
                    <div class="flex items-center gap-1">
                      <span class="material-symbols-outlined font-bold" [ngClass]="getColorClase(alternativa.ecoScore)">trending_up</span>
                      <span class="text-sm font-bold" [ngClass]="getColorClase(alternativa.ecoScore)">{{getPorcentajeAumento(alternativa.ecoScore)}}</span>
                    </div>
                  </div>
                </div>
                }
              </div>
            </div>


            <!-- Footer -->
            <div class="p-4 bg-gray-50 dark:bg-gray-800 text-center border-t border-gray-100 dark:border-gray-600">
              <p class="text-sm text-gray-500 dark:text-gray-400">
                <span class="font-medium text-gray-700 dark:text-gray-300">Tip:</span> Elegir alternativas con EcoScore
                superior a 90 reduce el impacto ambiental en un 35%.
              </p>
            </div>
          </div>

          }
        </div>
      </div>

      <!-- Right Column: EcoScore & Materials -->
      <div class="lg:col-span-1 flex flex-col gap-8">
        <!-- EcoScore Total Card -->
        <div class="bg-white dark:bg-gray-700 rounded-xl shadow-sm p-6 flex flex-col items-center gap-4">
          <p class="text-gray-700 dark:text-white text-lg font-bold leading-normal">EcoScore Total</p>
          <div class="relative size-40">
            <svg class="size-full" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
              <circle class="stroke-current text-gray-200 dark:text-gray-600" cx="18" cy="18" fill="none" r="16"
                stroke-width="3"></circle>
              <circle class="stroke-current" cx="18" cy="18" fill="none" r="16" stroke-dasharray="100.53"
                [attr.stroke-dashoffset]="calcularOffset(producto.ecoScore)" stroke-linecap="round" stroke-width="3"
                [ngClass]="getColorClase(puntuacion.valor)">
              </circle>
            </svg>
            <div class="absolute inset-0 flex flex-col items-center justify-center">
              <span
                class="text-4xl font-extrabold text-gray-700 dark:text-white">{{formatNumber(producto.ecoScore)}}</span>
              <span class="text-sm font-medium text-gray-500 dark:text-gray-400">/ 100</span>
            </div>
          </div>

          <!-- Action Buttons -->
          <button
            class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition-colors"
            (click)="abrirModal()">
            Ver detalles
          </button>
          <button
            class="w-full border-2 border-green-600 text-green-600 dark:text-green-400 dark:border-green-400 font-bold py-3 px-4 rounded-lg hover:bg-green-600/5 dark:hover:bg-green-400/10 transition-colors flex items-center justify-center gap-2"
            (click)="obetnerMejoresProductos()">

            <span class="material-symbols-outlined text-xl">swap_horiz</span>
            {{ mostrarAlternativas ? 'Ocultar Alternativas' : 'Mostrar Alternativas' }}
            <span class="material-symbols-outlined text-xl transition-transform duration-300"
              [class.rotate-180]="mostrarAlternativas">expand_more</span>

          </button>


        </div>

        <!-- Materials Card -->
        <div class="bg-white dark:bg-gray-700 rounded-xl max-h-52 shadow-sm p-6 flex flex-col gap-4 overflow-y-auto">
          <h3 class="text-gray-700 dark:text-white text-lg font-bold leading-normal">Materiales y Reciclabilidad</h3>
          <div class="flex flex-col gap-3">
            @for(material of materiales; track material.id){
            <div class="flex justify-between items-center">
              <p class="text-gray-700 dark:text-gray-300">{{material.nombre | nombreMaterial}}</p>
              <div class="flex items-center gap-2" [ngClass]="{'text-green-600 dark:text-green-400':material.reciclable,
              'text-yellow-600 dark:text-yellow-400':!material.reciclable
              }">
                <span class="material-symbols-outlined text-lg">recycling</span>
                <span class="text-sm font-medium">{{material.reciclable ? 'Reciclable':'No reciclable'}}</span>
              </div>
            </div>
            }
          </div>


        </div>
      </div>
    </div>

  </div>

  @if(modal){
  <app-modal-detalle [producto]="producto" [puntuacion]="puntuacion" [materiales]="materiales"
    (closeModal)="cerrarModal()"></app-modal-detalle>
  }

</div>