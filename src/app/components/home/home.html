<div class="flex flex-col min-h-screen w-full  dark:bg-gray-800">
  <!-- Main content - responsive padding for sidebar -->
  <main
    class="flex-1 w-full  sm:px-6 md:px-8 py-6 md:py-8 bg-[#f6f8f7] dark:bg-gray-800 h-screen md:h-auto overflow-y-auto">
    <div class="w-full max-w-[1200px] mx-auto pt-15">
      <div class="flex flex-col sm:flex-row gap-4 mb-8">
        <div
          class="grow flex items-stretch rounded-xl h-14 bg-white dark:bg-gray-700 border border-[#dbe6e0] dark:border-gray-600 focus-within:ring-2 focus-within:ring-[#39E079]/50 focus-within:border-[#39E079] transition-shadow overflow-hidden">
          <div class="flex items-center justify-center pl-4 pr-2">
            <span class="material-symbols-outlined text-gray-400 dark:text-gray-400 pointer-events-none">search</span>
          </div>
          <input
            [(ngModel)]="busqueda" (input)="buscar()"
            class="flex w-full min-w-0 flex-1 bg-transparent text-[#111814] dark:text-white placeholder:text-gray-400 dark:placeholder:text-gray-400 focus:outline-none border-0 border-none! outline-none ring-0 focus:ring-0 appearance-none px-2"
            placeholder="Buscar productos por nombre, descripción o puntuación (ej. 80)..." type="text">
        </div>
        <button
          (click)="openModalFiltros()"
          class="flex items-center justify-center gap-2 h-14 px-5 rounded-xl bg-white dark:bg-gray-700 border border-[#dbe6e0] dark:border-gray-600 text-[#111814] dark:text-white text-base font-semibold leading-normal hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors cursor-pointer">
          <span class="material-symbols-outlined">filter_list</span>
          <span>Filtros</span>
        </button>
        <button (click)="openModalEscaner()" class="flex min-w-[84px] cursor-pointer items-center justify-center  rounded-xl h-14 px-5 bg-primary text-[#111814] gap-2 text-base font-bold leading-normal tracking-[0.015em] hover:b
     g-primary transition-colors">
          <span class="material-symbols-outlined">qr_code_scanner</span>
          <span class="truncate">Escanear</span>
        </button>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 pb-12">
        <!-- Updated all dark mode backgrounds from dark:bg-[#182c21] to dark:bg-gray-700 to match sidebar -->

        @for (producto of productosPaginados; track producto.id) {
        <!-- Card con efecto hover suave -->
        <div
          class="cards flex flex-col gap-3 p-4 bg-white dark:bg-gray-700 rounded-xl border border-[#dbe6e0] dark:border-gray-600 hover:shadow-xl hover:-translate-y-2 hover:border-[#39E079]/50 dark:hover:border-[#39E079]/50 transition-all duration-300 ease-out cursor-pointer"
          (click)="abrirDetalle(producto.id)">
          <div class="w-full h-40 bg-cover bg-center rounded-lg"
            style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuC3ORf-FnudDaA1NzV5UvdmmzQpCofGyUeOmYqp59ZNzqs1Q0RlfF8qKyHUGrT-qJ8sPqHw1W3pMc948xO59s3AY4HAcV0uzJTUGuRd0j4ryP79b2Ddxlj8QMyI-yz_19Owq5mFLjVy8uhsmLW5qKQagIIedD5UcDa7QxihO4CUOStI4iqITk6jTR1CEyAoZCDmve56S8lZEjHbWqF2N5A0LTTX4vZJSYO2s65GdC51X5_avEfz4KPExWa-wKb_VqxqS9-lC0GX8wn3');">
          </div>
          <div class="flex flex-col grow">
            <p class="text-sm text-[#618972] dark:text-gray-400">{{producto.nombre}}</p>
            <h3 class="font-bold text-[#111814] dark:text-white leading-tight">{{producto.descripcion}}</h3>
          </div>
          <div class="flex items-center justify-between mt-2">
            <p class="text-xs text-[#618972] dark:text-gray-400">EcoScore</p>
            <div class="flex items-center gap-1 text-lg font-bold text-green-600 dark:text-green-400" [ngClass]="{'text-green-600 dark:text-green-400':producto.ecoScore>80,
              'text-yellow-500 dark:text-yellow-400':producto.ecoScore>50,
              'text-orange-500 dark:text-orange-400':producto.ecoScore>0
            }">
              <span class="material-symbols-outlined text-base"
                style="font-variation-settings: 'FILL' 1, 'wght' 600;">eco</span>
              <span>{{formatNumber(producto.ecoScore)}}</span>
            </div>
          </div>
        </div>
        } @empty {
        <div class="col-span-full flex flex-col items-center justify-center py-20">
          <div class="w-32 h-32 mb-6 text-gray-300 dark:text-gray-600">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-full h-full">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607zM10.5 7.5v6m3-3h-6" />
            </svg>
          </div>
          <h3 class="text-2xl font-bold text-gray-700 dark:text-gray-300 mb-2">No hay productos disponibles</h3>
          <p class="text-gray-500 dark:text-gray-400 text-center max-w-md">Aún no hay productos escaneados. ¡Empieza a buscar alternativas sostenibles escaneando un producto!</p>
          <button (click)="openModalEscaner()" class="mt-6 flex items-center gap-2 px-6 py-3 bg-primary text-[#111814] rounded-xl font-bold hover:bg-primary/90 transition-colors">
            <span class="material-symbols-outlined">qr_code_scanner</span>
            Escanear producto
          </button>
        </div>
        }


      </div>
      @if(productosFiltrados.length > 0){
      <app-paginacion [lista]="productosFiltrados" (pagin)="paginar($event)"></app-paginacion>
      }
    </div>
  </main>


</div>



<!--Modal para el escáner-->
@if(modalEscanerOpen){
<app-modal-escaner (closeModal)="closeModalEscaner()" (qrScanned)="obtenerQr($event)"></app-modal-escaner>
}

<!--Modal de exito o error-->
@if(modalSucces){
<app-modal-informativo [messageError]="error" [success]="success"
  (closeModal)="closeModalSucces()"></app-modal-informativo>
}

<!-- Loading Modal  -->
@if(loadingModal){

<app-loading-modal></app-loading-modal>
}

<!-- Modal Filtros -->
@if(modalFiltrosOpen){
<app-modal-filtros 
  (close)="closeModalFiltros()" 
  (aplicarFiltros)="aplicarFiltrosHomg($event)">
</app-modal-filtros>
}